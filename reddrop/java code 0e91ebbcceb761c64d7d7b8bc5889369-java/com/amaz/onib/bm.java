package com.amaz.onib;

import android.content.Context;
import android.os.Handler;
import android.os.Message;
import android.webkit.JavascriptInterface;
import android.webkit.WebSettings;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import org.cocos2dx.lib.GameControllerDelegate;
/* loaded from: classes.dex */

//[fmss] In handleMessage(), if the message parameter satisfies conditions, a StringBuffer with JavaScript code is created and then loaded with the loadUrl method
//[fmss] The same happens in onPageFinished(), but with different constraints on the tag of the items to be clicked
public class bm {

    /* loaded from: classes.dex */
    public interface a {
        void a(com.amaz.onib.b bVar);

        void fail(com.amaz.onib.b bVar, int i, String str);
    }

    /* loaded from: classes.dex */
    public static final class b {

        /* renamed from: a  reason: collision with root package name */
        WebView f677a;
        com.amaz.onib.b b;
        a c;
        boolean d = false;
        long e = 0;
        private Handler g = new Handler() { // from class: com.amaz.onib.bm.b.1
            @Override // android.os.Handler
            public void handleMessage(Message message) {
                if (message.what == 1000) {
                    b.this.c.fail(b.this.b, message.arg1, (String) message.obj);
                } else if (message.what == 1001) {
                    b.this.e++;
                    if (b.this.e >= b.this.f) {
                        bs.b("handleMessage: endlive");
                        b.this.g.removeMessages(1001);
                        b.this.c.a(b.this.b);
                        b.this.c();
                        return;
                    }
                    b.this.g.sendEmptyMessageDelayed(1001, 1000L);
                } else if (message.what == 1002) {
                    StringBuffer stringBuffer = new StringBuffer("var newscript = document.createElement('script');");
                    stringBuffer.append("newscript.innerHTML = '");
                    stringBuffer.append("var tlmer; var seq = 0;");
                    stringBuffer.append("function again(){");
                    stringBuffer.append("var allInputs = document.getElementsByTagName(\\'a\\');");
                    stringBuffer.append("for (var i=0;i<allInputs.length;i++){");
                    stringBuffer.append("inp = allInputs[i];");
                    stringBuffer.append("if(inp.outerHTML.indexOf(\\'live_entry\\')>0){");
                    stringBuffer.append("inp.click(); clearInterval(tlmer);return;");
                    stringBuffer.append("}");
                    stringBuffer.append("}");
                    stringBuffer.append("seq += 1;");
                    stringBuffer.append("if(seq==10){jsj.fail(2, document.documentElement.outerHTML);}");
                    stringBuffer.append("};");
                    stringBuffer.append("timer = setInterval(\\'again()\\', 1000);");
                    stringBuffer.append("';");
                    stringBuffer.append("document.body.appendChild(newscript);");
                    b.this.f677a.loadUrl("javascript:" + stringBuffer.toString());
                }
            }
        };
        final long f = 10;

        public b(WebView webView, com.amaz.onib.b bVar, a aVar) {
            this.f677a = webView;
            this.b = bVar;
            this.c = aVar;
        }

        public void a() {
            this.g.sendEmptyMessage(GameControllerDelegate.THUMBSTICK_RIGHT_X);
        }

        public void b() {
            this.e = 0L;
            this.g.removeMessages(1001);
            this.g.sendEmptyMessage(1001);
        }

        public void c() {
            try {
                if (this.f677a != null) {
                    this.f677a.clearHistory();
                    this.f677a.clearCache(true);
                    this.f677a.destroy();
                    this.f677a = null;
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
        }

        @JavascriptInterface
        public void fail(int i, String str) {
            if (!this.d) {
                bs.b("fail: type:" + i + "");
                this.d = true;
                Message message = new Message();
                message.what = 1000;
                message.arg1 = i;
                message.obj = str;
                this.g.sendMessage(message);
            }
        }
    }

    public static void a(Context context, com.amaz.onib.b bVar, a aVar) {
        WebView webView = new WebView(context);
        WebSettings settings = webView.getSettings();
        settings.setJavaScriptEnabled(true);
        settings.setPluginState(WebSettings.PluginState.ON);
        settings.setAllowFileAccess(true);
        webView.loadUrl(bVar.i);
        final b bVar2 = new b(webView, bVar, aVar);
        webView.addJavascriptInterface(bVar2, "jsj");
        webView.setWebViewClient(new WebViewClient() { // from class: com.amaz.onib.bm.1

            /* renamed from: a  reason: collision with root package name */
            boolean f676a = false;
            boolean b = true;

            @Override // android.webkit.WebViewClient
            public void onPageFinished(WebView webView2, String str) {
                super.onPageFinished(webView2, str);
                bs.b("onPageFinished: onPageFinished:" + str);
                if (this.b) {
                    StringBuffer stringBuffer = new StringBuffer("var newscript = document.createElement('script');");
                    stringBuffer.append("newscript.innerHTML = '");
                    stringBuffer.append("var allInputs = document.getElementsByTagName(\\'a\\');");
                    stringBuffer.append("var _r = 0;");
                    stringBuffer.append("for (var i=0;i<allInputs.length;i++){");
                    stringBuffer.append("inp = allInputs[i];");
                    stringBuffer.append("if(inp.outerHTML.indexOf(\\'http://m.miguxue.com/c/readView\\')>0){");
                    stringBuffer.append("_r = 1; inp.click();");
                    stringBuffer.append("}");
                    stringBuffer.append("}");
                    stringBuffer.append("if(_r==0){ jsj.fail(1, document.documentElement.outerHTML);}");
                    stringBuffer.append("';");
                    stringBuffer.append("document.body.appendChild(newscript);");
                    webView2.loadUrl("javascript:" + stringBuffer.toString());
                } else if (str.contains("/learn")) {
                    bs.b("onPageFinished: send");
                    if (!this.f676a) {
                        bs.b("onPageFinished: send...");
                        b.this.a();
                    }
                    this.f676a = true;
                } else if (str.contains("/live_entry")) {
                    bs.b("onPageFinished: startLive");
                    b.this.b();
                }
                this.b = false;
            }
        });
    }
}
